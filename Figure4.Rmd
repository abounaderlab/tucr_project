---
title: "Figure 4 related code"
output: html_notebook
---

## Title : A comprehensive analysis of Transcribed Ultra Conserved Regions uncovers important regulatory functions of novel non coding transcripts in gliomas

## Figure 4

```{r}
## Load Programs

if (!require("jsonlite")) install.packages("jsonlite")
library("jsonlite")

if (!require("tidyjson")) install.packages("tidyjson")
library("tidyjson")

if (!require("tidyverse")) install.packages("tidyverse")
library("tidyverse")

if (!require("ggplot2")) install.packages("ggplot2")
library("ggplot2")

if (!require("ggforce")) install.packages("ggforce")
library("ggforce")

if (!require("ggbreak")) install.packages("ggbreak")
library("ggbreak")

if (!require("ggrepel")) install.packages("ggrepel")
library("ggrepel")

if (!require("ggfortify")) install.packages("ggfortify")
library("ggfortify")

if (!require("ggdendro")) install.packages("ggdendro")
library("ggdendro")

if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")
if (!requireNamespace("DESeq2", quietly = TRUE))BiocManager::install("DESeq2")
library("DESeq2")

if (!require("survival")) install.packages("survival")
library("survival")

if (!require("broom")) install.packages("broom")
library("broom")

if (!requireNamespace("limma", quietly = TRUE))BiocManager::install("limma")
library("limma")

if (!require("Tmisc")) install.packages("Tmisc")
library("Tmisc")

if (!require("survminer")) install.packages("survminer")
library("survminer")

if (!require("corrr")) install.packages("corrr")
library("corrr")

if (!require("here")) install.packages("here")
library("here")

if (!require("lessR")) install.packages("lessR")
library("lessR")

if (!require("splitstackshape")) install.packages("splitstackshape")
library(splitstackshape)

if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")

if (!require('org.Hs.eg.db')) BiocManager::install('org.Hs.eg.db')
library(org.Hs.eg.db)

if (!require('GO.db')) BiocManager::install('GO.db')
library(GO.db)

if (!require('limma')) BiocManager::install('limma')
library(limma)

if (!require("ggthemes")) install.packages('ggthemes', dependencies = TRUE)
library(ggthemes)

if (!require("gplots")) 
install.packages("gplots")
library(gplots)

if (!require("ggsignif")) 
install.packages("ggsignif")
library(ggsignif)

if (!require("RColorBrewer")) 
install.packages("RColorBrewer")
library(RColorBrewer)

if (!require("reshape2")) 
install.packages("reshape2")
library(reshape2)

if (!require("gridExtra")) 
install.packages("gridExtra")
library(gridExtra)

if (!require("dendextend")) 
install.packages("dendextend")
library(dendextend)

if (!require("plyr")) 
install.packages("plyr")
library(plyr)

if (!require("magick")) 
install.packages("magick")
library(magick)

if (!require("png")) 
install.packages("png")
library(png)

if (!require("scales")) 
install.packages("scales")
library(scales)

if (!require("ggsci")) 
install.packages("ggsci")
library(ggsci)

if (!require("stringi")) install.packages("stringi")
  library(stringi)
if (!require("stringr")) install.packages("stringr")
  library(stringr)

if (!require("impute")) BiocManager::install("impute")
library(impute)

if (!require("preprocessCore")) BiocManager::install("preprocessCore")
library(preprocessCore)

if (!require("Go.db")) BiocManager::install("GO.db")
library(GO.db)


if (!require("WGCNA")) install.packages("WGCNA")
library(WGCNA)

if (!require("umap")) install.packages("umap")
library(umap)

if (!require("igraph")) install.packages("igraph")
library(igraph)

if (!require("gtable")) install.packages("gtable")
library(gtable)

if(!dir.exists(outputdir)){
  dir.create(outputdir)
}

knitr::opts_chunk$set(
eval = FALSE,
tidy = TRUE#,
#	echo = TRUE,
#	message = FALSE,
#	warning = FALSE
)

```
## Figure 4. 

```{r dircreate_Figure4}

dir.create(paste(outputdir,"/Figure4/",sep=""))

```
### Figure 4A
## Bar graph depicting uc.110 upregulation in banked UVA GBM tumors versus normal brain cortex. 
```{r Figure4a}

data <- read_csv("./Inputs/Figure4/Figure4a_input.csv") 

p <- ggplot(data,aes(x=reorder(Sample,Order), y=as.numeric(FoldChange),fill=Sample)) +
        geom_bar(stat="identity"
                 #,color="black"
                   ) +
        geom_errorbar(aes(ymax=FoldChange+stderr, ymin=FoldChange-stderr, width=.2)) +
        geom_text(aes(y = FoldChange, label=pvalue,vjust=-0.25,hjust=0.5),color = "#000000",size=10) + 
        scale_y_continuous(limits = c(-0.25,7),breaks= scales::pretty_breaks(n=9)) +
        #geom_hline(yintercept = log10(5),linetype = 2,size=1.5) +
        #geom_vline(xintercept = -0.65,linetype = 2,size=1.5) +
        #geom_vline(xintercept = 0.65,linetype = 2,size=1.5) +
        #scale_color_identity(guide = "legend", labels = cellfracdata$Fraction, breaks = cellfracdata$Fraction) +
        labs(y = "log2(uc.110 FoldChange)",
        x = "GT = GBM Tumor, NBC = Normal Brain Cortex") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="none",legend.title=element_blank(),
legend.text=element_blank()) + 
  coord_cartesian(clip = "off")

p

ggsave(file=paste(outputdir,"/Figure4/Figure4a.png",sep=""),
       plot = print(p),
       height = 6,
       width = 6,
       dpi = 600)

```

### Figure 4B

## uc.110 expression in GBM Tumors (summarized)

```{r Figure4b}

data <- read_csv("./Inputs/Figure4/Figure4b_input.csv") 

p <- ggplot(data,aes(x=dex, y=FC,fill=Fill)) +
  geom_boxplot(outlier.color="white") +
  #geom_bar(colour="black",stat="identity") +
  scale_fill_identity() +
  #scale_color_manual(values = c("black"="black","red"="red","green"="green")) +
  geom_jitter(data = data, aes(x=dex, y=FC),binaxis='y', stackdir='center', stackratio=0.90, dotsize=0.30,fill="gray",width=0.2) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_line(colour = "black"),
        plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
        axis.title = element_text(size = rel(1.8), face="bold"),
        axis.text.y = element_text(size = rel(2.5), face="bold"),
        axis.text.x = element_text(size = rel(2.5), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
        legend.position="none",
        legend.title=element_blank(),
        legend.text=element_blank()) +
  labs(y="log2FoldChange", x = "Tissue Type") +
  stat_summary(fun.y=mean, geom="point", shape=20, size=10, color=paper_blue, fill=paper_blue)

p

ggsave(file=paste(outputdir,"/Figure4/Figure4b.png",sep=""),
       plot = print(p),
       height = 7,
       width = 5,
       dpi = 600)

```

### Figure 4C
## Bar graph depicting qPCR validation of uc.110 siRNA knockdown and rescue in A172 and U251 cell lines. 
```{r Figure4c}

data <- read_csv("./Inputs/Figure4/Figure4c_input.csv") %>% 
  mutate(fillcolor = paste(Gene,Sample,sep=" ")) #%>%
  #filter(Gene == "LV-pCDH")

p <- ggplot(data,aes(x=reorder(Gene,order), y=FC,fill=reorder(Sample,order))) +
        geom_bar(stat="identity",position = "dodge") +
        geom_errorbar(aes(ymax=FC+stderr, ymin=FC-stderr, width=.2),position = position_dodge(0.9)) +
        geom_text(aes(y = FC, label=pvalue,vjust=-0.25,hjust=0.5),color = "#000000",size=10,position = position_dodge(0.9)) + 
        scale_fill_manual(values = c(paper_red,paper_green,paper_blue,paper_gold,paper_turq,paper_purple)) +
        labs(y = "Relative uc.110 expression",
        x = "") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2),face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.2)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank(),) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~CellLine)


p

ggsave(file=paste(outputdir,"/Figure4/Figure4c.png",sep=""),
       plot = print(p),
       height = 6,
       width = 6,
       dpi = 600)

```

### Figure 4D
## Line graph showing that knockdown of uc.110 reduces A172 and U251 cell accumulation over a 5-7 day period
```{r Figure4d}

data <- read_csv("./Inputs/Figure4/Figure4d_input.csv") %>%
  group_by(Day,siRNA,Sample,Color) %>%
  dplyr::summarise(mean = mean(Count,na.rm=TRUE),n=n(),stddev= sd(Count,na.rm=TRUE),stderr=stddev/n) %>%
  mutate(pvalue = ifelse(Day == 7 & siRNA != "si-SCR" & Sample == "A172","*",
                  ifelse(Day == 5 & siRNA != "si-SCR" & Sample == "U251","*","")))

p <- ggplot(data,aes(x=Day,y=mean,color=siRNA)) +
  geom_line(size=1.2) +
  geom_point(size=3) +
  geom_text(aes(x=Day,y=mean, label=pvalue,vjust=-0.25,hjust=0.5),color = "#000000",size=10) +
  geom_errorbar(aes(ymax=mean+stderr, ymin=mean-stderr, width=.2)) +
  scale_color_manual(values = c(paper_red,paper_green,paper_blue)) +
  labs(y = "Number of Cells",
        x = "Days post transfection") +
  theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.2)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank()) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~Sample) 

p

ggsave(file=paste(outputdir,"/Figure4/Figure4d.png",sep=""),
       plot = print(p),
       height = 5,
       width = 10,
       dpi = 600)

```

### Figure 4E
## Bar graph depicting that the cell accumulation phenotype is rescued when uc.110 is overexpressed in the presence of siRNA. Images are representative of the listed sample
```{r Figure4e}

data <- read_csv("./Inputs/Figure4/Figure4e_input.csv") %>% 
  mutate(fillcolor = paste(Gene,Sample,sep=" "))

p <- ggplot(data,aes(x=reorder(Gene,order), y=FC,fill=reorder(Sample,order))) +
        geom_bar(stat="identity",position = "dodge") +
        geom_errorbar(aes(ymax=FC+stderr, ymin=FC-stderr, width=.2),position = position_dodge(0.9)) +
        geom_text(aes(y = FC, label=pvalue,vjust=-0.25,hjust=0.5),color = "#000000",size=10,position = position_dodge(0.9)) + 
        scale_fill_manual(values = c(paper_red,paper_green,paper_blue,paper_gold,paper_turq,paper_purple)) +
        labs(y = "Relative accumulated cells",
        x = "") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.0)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank()) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~CellLine)


p

ggsave(file=paste(outputdir,"/Figure4/Figure4e.png",sep=""),
       plot = print(p),
       height = 6,
       width = 6,
       dpi = 600)

```

### Figure 4F
## Bar graph showing that knockdown of uc.110 reduces A172 and U251 cell viability via Alamar Blue assay and can be rescued with uc.110 overexpression
```{r Figure4f}

data <- read_csv("./Inputs/Figure4/Figure4f_input.csv") %>% 
  mutate(fillcolor = paste(Gene,Sample,sep=" "))

p <- ggplot(data,aes(x=reorder(Gene,order), y=FC,fill=reorder(Sample,order))) +
        geom_bar(stat="identity",position = "dodge") +
        geom_errorbar(aes(ymax=FC+stderr, ymin=FC-stderr, width=.2),position = position_dodge(0.9)) +
        geom_text(aes(y = FC, label=pvalue,vjust=-0.25,hjust=0.5),color = "#000000",size=10,position = position_dodge(0.9)) + 
        scale_fill_manual(values = c(paper_red,paper_green,paper_blue,paper_gold,paper_turq,paper_purple)) +
        labs(y = "Relative AlamarBlue Signal",
        x = "") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.2)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank()) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~CellLine)


p

ggsave(file=paste(outputdir,"/Figure4/Figure4f.png",sep=""),
       plot = print(p),
       height = 6,
       width = 7,
       dpi = 600)

```


### Figure 4G
## Bar graph showing that knockdown of uc.110 reduces GSC-34 glioma stem cell viability via AlamarBlue
```{r Figure4g}

data <- read_csv("./Inputs/Figure4/Figure4g_input.csv") %>% 
  mutate(fillcolor = paste(Gene,Sample,sep=" "))

p <- ggplot(data,aes(x=reorder(Sample,order), y=FC,fill=reorder(Sample,order))) +
        geom_bar(stat="identity",position = "dodge") +
        geom_errorbar(aes(ymax=FC+stderr, ymin=FC-stderr, width=.2),position = position_dodge(0.9)) +
        geom_text(aes(y = FC, label=pvalue,vjust=-1.5,hjust=0.5),color = "#000000",size=10,position = position_dodge(0.9)) + 
        scale_fill_manual(values = c(paper_red,paper_green,paper_blue,paper_gold,paper_turq,paper_purple)) +
        labs(y = "Relative AlamarBlue Signal",
        x = "") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.0)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank()) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~CellLine)


p

ggsave(file=paste(outputdir,"/Figure4/Figure4g.png",sep=""),
       plot = print(p),
       height = 6,
       width = 6,
       dpi = 600)

```

### Figure 4H
## Bar graph showing knockdown of uc.110 reduces A172 and U251 cell invasion and migration
```{r 3h}

data <- read_csv("./Inputs/Figure4/Figure4h_input.csv") 

p <- ggplot(data,aes(x=reorder(Sample,order), y=FC,fill=reorder(Sample,order))) +
        geom_bar(stat="identity",position = "dodge") +
        geom_errorbar(aes(ymax=FC+stderr, ymin=FC-stderr, width=.2),position = position_dodge(0.9)) +
        geom_text(aes(y = FC, label=pvalue,vjust=-1.5,hjust=0.5),color = "#000000",size=10,position = position_dodge(0.9)) + 
        scale_fill_manual(values = c(paper_red,paper_green,paper_blue,paper_gold,paper_turq,paper_purple)) +
        labs(y = "Relative invading cells",
        x = "") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.0)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank()) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~CellLine)


p

ggsave(file=paste(outputdir,"/Figure4/Figure4h.png",sep=""),
       plot = print(p),
       height = 6,
       width = 6,
       dpi = 600)

```

### Figure 4I
## Bar graph showing the qPCR validation of overexpression in GSC-28 glioma stem cells and U87 cells
```{r Figure4i}

data <- read_csv("Inputs/Figure4/Figure4i_input.csv")

p <- ggplot(data,aes(x=reorder(Gene,order), y=FC,fill=Gene)) +
        geom_bar(stat="identity",position = "dodge") +
        geom_errorbar(aes(ymax=FC+stderr, ymin=FC-stderr, width=.2),position = position_dodge(0.9)) +
        geom_text(aes(y = FC, label=pvalue,vjust=-3.0,hjust=0.5),color = "#000000",size=10,position = position_dodge(0.9)) + 
        scale_fill_manual(values = c(paper_gold,paper_purple)) +
        labs(y = "Relative uc.110 expression",
        x = "") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.0)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank(),) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~CellLine,scales="free")


p

ggsave(file=paste("Outputs/Figure4/Figure4i.png",sep=""),
       plot = print(p),
       height = 12,
       width = 6,
       dpi = 600)

```

### Figure 4J
## Bar graph showing that overexpression of uc.110 increases cell accumulation in U87 and GSC-28 cells
```{r Figure4j}

data <- read_csv("./Inputs/Figure4/Figure4j_input.csv")

p <- ggplot(data,aes(x=reorder(Gene,order), y=FC,fill=Gene)) +
        geom_bar(stat="identity",position = "dodge") +
        geom_errorbar(aes(ymax=FC+stderr, ymin=FC-stderr, width=.2),position = position_dodge(0.9)) +
        geom_text(aes(y = FC, label=pvalue,vjust=-1.5,hjust=0.5),color = "#000000",size=10,position = position_dodge(0.9)) + 
        scale_fill_manual(values = c(paper_gold,paper_purple)) +
        labs(y = "Relative accumulated cells",
        x = "") +
        #ylim(-5, 10) +
        theme(plot.title = element_text(size = rel(2.2), hjust = 0.5, face="bold",margin=margin(0,0,0,0)),
              axis.title = element_text(size = rel(1.6), face="bold"),
              axis.text.y = element_text(size = rel(2.2), face="bold"),
              axis.text.x = element_text(size = rel(2.2), face="bold",angle=90,vjust = 0.5, hjust=1),
              #panel.grid = element_line(color = "lightgray",size = 0.75),
panel.background = element_blank(), axis.line = element_line(colour = "black"),legend.position="top",legend.title=element_blank(),
legend.text=element_text(size=rel(2.0)),
strip.text.x = element_text(size = rel(2.2)),
strip.background = element_blank(),) + 
  coord_cartesian(clip = "off") +
  facet_wrap(~CellLine)


p

ggsave(file=paste(outputdir,"/Figure4/Figure4j.png",sep=""),
       plot = print(p),
       height = 8,
       width = 4,
       dpi = 600)

```


```{r}
sessionInfo()
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
